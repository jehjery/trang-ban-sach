package dao;

import java.util.ArrayList;
import java.util.Collection;

import org.bson.Document;
import org.bson.conversions.Bson;

import com.google.gson.Gson;
import com.mongodb.client.FindIterable;
import com.mongodb.client.MongoCollection;
import com.mongodb.client.MongoDatabase;
import com.mongodb.client.model.Filters;
//import com.mongodb.client.model.Updates;

import bean.loaibean;
import bean.sachbean;
import connectDB.connectDB;

public class sachdao {
public	ArrayList<sachbean> dssach= new ArrayList<sachbean>();
	MongoDatabase database = connectDB.getInstance();
	MongoCollection<Document> collection = database.getCollection("tbSach"); 
	// lấy bảng 
	public ArrayList<sachbean> findAll(int page, int pageSize) {
		ArrayList<sachbean> listloai = new ArrayList<>();
		collection.find().skip(pageSize*(page-1)).limit(pageSize).forEach(doc ->  
		{
			Gson gson = new Gson();
			sachbean loai = gson.fromJson(doc.toJson(), sachbean.class);
			listloai.add(loai);
		});
		
		return listloai;
	}
	public FindIterable<Document> Findloai(String maloai) {
		System.out.println(maloai);
		Bson filters = Filters.eq("maloai", maloai);		
		gson: từ object -> JSON(chuỗi string)
		//Gson gson = new Gson();
		Document doc = Document.parse(gson.toJson(l));
		// bson: hổ trợ câu lệch cho monggo
		Bson listsach= Updates.set("tenloai", l.getTenloai());
		return collection.find(filters);
	}
		
		public ArrayList<sachbean> findAll() {
			ArrayList<sachbean> list = new ArrayList<>();
			collection.find().forEach(doc -> 
			{
				Gson gson = new Gson();
				sachbean sach = gson.fromJson(doc.toJson(), sachbean.class);
				list.add(sach);
			});
			
			return list;
		}
		
		public void insert(sachbean l) {
			Gson gson = new Gson();
			Document doc = Document.parse(gson.toJson(l));
			collection.insertOne(doc);
		}

	}



